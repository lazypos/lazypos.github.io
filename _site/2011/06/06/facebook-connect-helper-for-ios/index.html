<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-gb">
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<title>Facebook Connect Helper for iOS</title>
	<meta name="author" content="大狗哥" />
	<link rel="stylesheet" href="/css/syntax.css" type="text/css" media="all" />
	<link rel="stylesheet" href="/css/screen.css" type="text/css" media="all" />
	<link rel="stylesheet" href="/css/tablet.css" type="text/css" media="screen and (min-width:651px) and (max-width: 1024px), screen and (min-device-width: 768px) and (max-device-width: 1024px)" />
	<link rel="stylesheet" href="/css/mobile.css" type="text/css" media="handheld, screen and (max-width: 650px), screen and (max-device-width: 480px)" />
</head>
<body>
	<div class="site">
		<div class="title"><big><a href="/">大狗哥的狗窝</a></big></div>
		<div id="post">
	<h1>Facebook Connect Helper for iOS</h1>
	<p class="meta">06 Jun 2011</p>
	<p>Many iPhone/iPad apps use Facebook Connect, and Facebook have made this really easy with their <a href="https://github.com/facebook/facebook-ios-sdk">Facebook iOS SDK</a>.</p>

<p>One thing that you will always most likely want to do is make sure that the user only has to log in once, and every time time they want to use your app that they are already authenticated with Facebook. This means two things: first you need to make sure you authenticate the user with the <code>offline_access</code> flag and secondly, save the access tokens for the next time your app is used.</p>

<p>This led me to create a very simple helper class that I use in conjunction with the Facebook SDK to make my life a little easier:</p>

<pre><code>// FacebookHelper.h

#import "FBConnect.h"
@interface FacebookHelper : NSObject {

}

+(Facebook*)fb;
+(void) resume;
+(void) save;
+(void) revoke;

@end

//FacebookHelper.m

static NSString* kFBAccessToken = @"FBAccessToken";
static NSString* kFBExpirationDate = @"FBExpirationDate";

@implementation FacebookHelper

+(Facebook*)fb {
	static Facebook *fb = nil;

	if (fb == nil) {
		fb = [[Facebook alloc] initWithAppId:FB_APP_ID];
	}

	return fb;
}

+(void) resume {
  NSUserDefaults *defaults = [NSUserDefaults standardUserDefaults];
  Facebook *facebook = [FacebookHelper fb];
  facebook.accessToken = [defaults stringForKey:kFBAccessToken];
  facebook.expirationDate = (NSDate*)[defaults objectForKey:kFBExpirationDate];
}

+(void) save {
  NSUserDefaults *defaults = [NSUserDefaults standardUserDefaults];
  Facebook *facebook = [FacebookHelper fb];

  [defaults setObject:facebook.accessToken forKey:kFBAccessToken];
  [defaults setObject:facebook.expirationDate forKey:kFBExpirationDate];
  [defaults synchronize];
}

+(void) revoke {
  NSUserDefaults *defaults = [NSUserDefaults standardUserDefaults];
  [defaults removeObjectForKey:kFBAccessToken];
  [defaults removeObjectForKey:kFBExpirationDate];
  [defaults synchronize];
}

@end
</code></pre>

<p>As you can see I have a static object for the Facebook SDK, and three simple static method to help me deal with login and logout. Now in my <code>applicationDidFinishLaunching</code> method on my <code>AppDelegate</code> I simply call:
	[FacebookHelper resume];
And when <code>fbDidLogin</code> and <code>fbDidLogin</code> are called:
	[FacebookHelper save];
and
	[FacebookHelper revoke];</p>

<p>Simple!</p>


</div>



<div id="related">
  <h2>其它文章</h2>
  <ul class="posts">
    
      <li><span>22 Jun 2014</span> <span class="seperator">--</span> <a href="/2014/06/22/dagougetest2/">功能测试文章</a></li>
    
      <li><span>19 Jun 2014</span> <span class="seperator">--</span> <a href="/2014/06/19/cctil-e-dsdmap12/">CCTMXTiledMap 使用说明</a></li>
    
      <li><span>14 Jun 2014</span> <span class="seperator">--</span> <a href="/2014/06/14/dogremove1/">狗窝搬家记</a></li>
    
  </ul>
</div>



<div class="comments">
	<h3>Comments</h3>
	<noscript>Please enable JavaScript to view the comments</noscript>
	<div id="disqus_thread"></div>
</div>
<script type="text/javascript">
    var disqus_shortname = 'dagouge';
    var disqus_identifier = '/2011/06/06/facebook-connect-helper-for-ios';
    var disqus_url = 'http://dagouge.com/2011/06/06/facebook-connect-helper-for-ios/';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>

		<div class="footer">
			<div class="contact">
                <div style="display: none"> <a href="http://info.flagcounter.com/lIbm"><img alt="Flag Counter" src="http://s05.flagcounter.com/count/lIbm/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_12/viewers_0/labels_0/pageviews_1/flags_1/" border="0" /></a>
                </div>
				<p><big></br>
                    Powered by <a href="http://jekyllrb.com">Jekyll</a> and <a href="https://pages.github.com">Github Pages</a> Copyright @2003-2015 <a href="/">dagouge.com</a> Corporation, All Rights Reserved
                </big></p>
			</div>
		</div>
	</div>
</body>
<html>